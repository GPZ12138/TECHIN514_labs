#include <Arduino.h>

// 选择一个可靠的 ADC1 引脚：A0 / A1 / A2
const int ANALOG_PIN = A0;

void setup() {
  Serial.begin(115200);
  delay(500);

  Serial.println("\n=== ESP32C3 ADC Voltage Reader ===");
  Serial.println("Connect PCB OUT -> A0, PCB GND -> GND\n");

  // 确保 analogRead() 返回 0~4095（12-bit）
  analogReadResolution(12);  // 默认就是 12-bit，但写上更清晰 :contentReference[oaicite:1]{index=1}

  // 可选：设置衰减，让量程更适合接近 3.3V 的输入（不同核心/芯片行为略有差异）
  // analogSetAttenuation(ADC_11db);
}

void loop() {
  int adc = analogRead(ANALOG_PIN);  // 0~4095
  float voltage = (adc / 4095.0f) * 3.3f;  // 你要求的公式

  // 可选：更接近“校准后”的电压（mV），用于对照
  // 在很多 ESP32 Arduino Core 里可用（包含 ESP32-C3）
  int mv = analogReadMilliVolts(ANALOG_PIN);
  float voltageCal = mv / 1000.0f;

  Serial.print("ADC=");
  Serial.print(adc);
  Serial.print("  V(formula)=");
  Serial.print(voltage, 3);
  Serial.print(" V  V(mV_cal)=");
  Serial.print(voltageCal, 3);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  Serial.println(" V");

  delay(200);
}
